{% extends "base.html" %}

{% block title %}Saved Jobs - Job Sight{% endblock %}

{% block content %}
<div class="hero">
    <h1>Your Saved Jobs</h1>
    <p>Manage your saved job opportunities and build your recruitment pipeline.</p>
</div>

<!-- Saved Jobs Count -->
<div style="margin-bottom: 2rem;">
    <p><strong>{{ saved_jobs.total }} jobs saved</strong></p>
</div>

<!-- Saved Jobs List -->
{% if saved_jobs.items %}
<div>
    {% for job in saved_jobs.items %}
    <div class="card job-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                    <h3 class="job-title">
                        <a href="{{ job.job_url }}" target="_blank">{{ job.job_title }}</a>
                    </h3>
                    <button class="save-job-btn" 
                            data-job-id="{{ job.job_id }}"
                            style="color: #667eea;">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="job-meta">
                    <span>
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        {{ job.company }}
                    </span>
                    <span>
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        {{ job.location }}
                    </span>
                    <span>
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Saved {{ job.saved_at.strftime('%B %d, %Y') }}
                    </span>
                </div>
                
                {% if job.salary_min or job.salary_max %}
                <div class="salary-badge">
                    {% if job.salary_min and job.salary_max %}
                        £{{ "{:,.0f}".format(job.salary_min) }} - £{{ "{:,.0f}".format(job.salary_max) }}
                    {% elif job.salary_min %}
                        £{{ "{:,.0f}".format(job.salary_min) }}+
                    {% elif job.salary_max %}
                        Up to £{{ "{:,.0f}".format(job.salary_max) }}
                    {% endif %}
                </div>
                {% endif %}
                
                {% if job.description %}
                <p class="job-description">
                    {{ job.description[:300] }}{% if job.description|length > 300 %}...{% endif %}
                </p>
                {% endif %}
                
                <div class="job-actions">
                    <a href="{{ job.job_url }}" target="_blank" class="btn btn-primary">
                        View Job
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-left: 0.25rem;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                    </a>
                    <span style="font-size: 0.8rem; color: #666;">Click bookmark to remove</span>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if saved_jobs.pages > 1 %}
<div class="pagination">
    {% if saved_jobs.has_prev %}
    <a href="{{ url_for('saved_jobs', page=saved_jobs.prev_num) }}">Previous</a>
    {% endif %}
    
    <span class="current">
        Page {{ saved_jobs.page }} of {{ saved_jobs.pages }}
    </span>
    
    {% if saved_jobs.has_next %}
    <a href="{{ url_for('saved_jobs', page=saved_jobs.next_num) }}">Next</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<!-- No Saved Jobs -->
<div style="text-align: center; padding: 3rem 0;">
    <div style="width: 6rem; height: 6rem; background: #f7fafc; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
        <svg width="48" height="48" fill="none" stroke="#9ca3af" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
        </svg>
    </div>
    <h3 style="margin-bottom: 0.5rem;">No saved jobs yet</h3>
    <p style="margin-bottom: 1.5rem;">Start searching for jobs and save the ones you're interested in.</p>
    <a href="{{ url_for('index') }}" class="btn btn-primary">Search Jobs</a>
</div>
{% endif %}

<!-- Remove Job JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add event listeners to remove job buttons
    document.querySelectorAll('.save-job-btn').forEach(button => {
        button.addEventListener('click', function() {
            const jobId = this.dataset.jobId;
            removeJob(jobId, this);
        });
    });
});

function removeJob(jobId, buttonElement) {
    fetch('/unsave_job', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({job_id: jobId})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Remove the job card from the page
            const jobCard = buttonElement.closest('.card');
            jobCard.style.transition = 'opacity 0.3s ease-out';
            jobCard.style.opacity = '0';
            setTimeout(() => {
                jobCard.remove();
                // Update the count
                const countElement = document.querySelector('p strong');
                if (countElement) {
                    const currentCount = parseInt(countElement.textContent.match(/\d+/)[0]);
                    countElement.textContent = `${currentCount - 1} jobs saved`;
                }
            }, 300);
        } else {
            alert(data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to remove job');
    });
}
</script>
{% endblock %}